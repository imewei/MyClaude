workflow:
  name: "quality-improvement"
  description: "Complete code quality improvement workflow with auto-fix, tests, and commit"
  version: "1.0"
  author: "Claude Code Framework"
  tags: [quality, testing, automation]
  rollback_on_error: true

variables:
  target_path: "."
  language: "auto"
  coverage_target: 90
  commit_message: "Improve code quality"

steps:
  - id: check_quality
    command: check-code-quality
    description: "Analyze code quality and identify issues"
    flags:
      - --language=${language}
      - --analysis=basic
      - --format=text
    input: ${target_path}

  - id: auto_fix_issues
    command: check-code-quality
    description: "Auto-fix identified quality issues"
    flags:
      - --auto-fix
      - --language=${language}
    input: ${target_path}
    depends_on: [check_quality]
    condition: "check_quality.success"
    on_error: continue

  - id: clean_codebase
    command: clean-codebase
    description: "Clean up unused imports and dead code"
    flags:
      - --imports
      - --dead-code
      - --analysis=thorough
    input: ${target_path}
    depends_on: [auto_fix_issues]

  - id: refactor_code
    command: refactor-clean
    description: "Apply modern refactoring patterns"
    flags:
      - --language=${language}
      - --scope=project
      - --patterns=modern
      - --implement
    input: ${target_path}
    depends_on: [clean_codebase]
    on_error: continue

  - id: generate_tests
    command: generate-tests
    description: "Generate comprehensive test suite"
    flags:
      - --type=all
      - --framework=auto
      - --coverage=${coverage_target}
    input: ${target_path}
    depends_on: [refactor_code]

  - id: run_tests
    command: run-all-tests
    description: "Run all tests to validate changes"
    flags:
      - --scope=all
      - --coverage
      - --auto-fix
    depends_on: [generate_tests]
    retry:
      max_attempts: 2
      backoff: linear

  - id: quality_check_final
    command: check-code-quality
    description: "Final quality verification"
    flags:
      - --language=${language}
      - --report
    input: ${target_path}
    depends_on: [run_tests]

  - id: commit_changes
    command: commit
    description: "Commit quality improvements"
    flags:
      - --all
      - --ai-message
      - --validate
    depends_on: [quality_check_final]
    condition: "quality_check_final.success"
    rollback_command: git
    rollback_flags: ["reset", "--hard", "HEAD~1"]